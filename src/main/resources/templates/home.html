<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorator="~{layout/afterLogin.html}" xmlns:v-on="http://www.w3.org/1999/xhtml">
<head>
</head>
<body>
    <th:block layout:fragment="content">
        <div class="container">
            <div class="panel panel-info" id="serverPanel">
                <div class="panel-heading" style="padding-bottom:0px; padding-right:10px"><h1>서버 상태</h1>
                    <p class="text-right" style="margin-bottom:2px; font-size:10pt">서버에 사람이 없을 경우 3분뒤 종료됩니다</p>
                </div>
                <table class="table table-bordered table-hover">
                    <thead>
                    <tr>
                        <th>name</th>
                        <th>download</th>
                        <th>ip</th>
                        <th>online</th>
                        <th>user</th>
                        <th>etc</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <th>{{server.name}}</th>
                        <th><a href="#" @click="download">link</a></th>
                        <th>{{server.ip}}</th>
                        <th :class="serverOnline">{{server.online}}</th>
                        <th>{{server.user}}</th>
                        <th><button v-if="server.ip === 'null'" type="button" class="btn btn-success" @click="serverStart(server.name, $event)">서버구동</button></th>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </th:block>
    <th:block layout:fragment="script">
        <script>
            new Vue({
                el : "#serverPanel",
                data : {
                    server : {
                        name : '',
                        ip : '',
                        online: 'off',
                        user: '',
                        link: ''
                    },
                    serverOnline : ''
                },
                methods : {
                    updateServerStatus : function() {
                        this.interval = setInterval(function(){
                            this.refreshServer();
                        }.bind(this), 5000);
                    },
                    refreshServer : function() {
                        axios.get('/server/status/mcu_server_01')
                            .then(value => {
                                this.server = value.data;
                                if(this.server.online === 'on') {
                                    this.serverOnline = 'success';
                                } else {
                                    this.serverOnline = '';
                                }
                            });
                    },
                    serverStart : function(serverName, event) {
                        event.target.disabled = true;
                        axios.get('/server/start/'+serverName)
                            .then(value => {
                                console.log(value.data);
                            });
                    },
                    download : function() {
                        window.open(this.server.link,"_blank");
                    }
                },
                created : function() {
                    this.refreshServer();
                    document.getElementById("headerHome").appendChild("<span class='sr-only'>(current)</span>");
                },
                mounted : function () {
                    this.updateServerStatus();
                },
                destroyed() {
                    clearInterval(this.interval);
                }
            });

        </script>
    </th:block>
</body>
</html>